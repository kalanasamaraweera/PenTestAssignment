#!/usr/bin/python

import os

print('|-----------------------------------------------------|')
print('|                                                     |')
print('|       DJANGO SQL INJECTION CRAWLER v1.0             |')
print('|                                                     |')
print('|=====================================================|')
print('|                                                     |')
print('| Developed by: S.A.K.G. Samaraweera                  |')
print('|-----------------------------------------------------|')
print('|                                                     ')

# Example:
# python crawler.py /home/kalana/PenTest/PenTestAssignment/HackMeIfUCan

DJANGO_PROJECT_ROOT = input("| Enter path to Django Project:")

print('|                                                     ')

PROJ_FOLDER = os.path.basename(os.path.normpath(DJANGO_PROJECT_ROOT))

if os.path.exists(DJANGO_PROJECT_ROOT + '/' + PROJ_FOLDER):
    for elems in os.walk(DJANGO_PROJECT_ROOT):
            if "views.py" in elems[2]:
                with open(elems[0]+ '/'+ 'views.py', 'r') as v:
                    for num, line in enumerate(v, 1):
                        if "def" in line and "request" in line and ":" in line:
                            print("| [INFO] Scan method: "+ line +" in line "+str(num)+"")
                        if "objects.raw(" in line:
                            print("|  [WARN] %s at line %i" % (line, num))
                        if 'request.GET.get(' in line:
                            print("|  [WARN] %s at line %i" % (line, num))



print('|')    
print('| Hit Enter to quit!')
input('|-----------------------------------------------------|')